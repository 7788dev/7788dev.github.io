---
title: 路由协议优先级详解：常见的厂商路由协议优先级对比
date: 2025-09-09 15:58:15
tags: 网络设备
---
> 在网络世界中，路由器常常会通过多种方式学到通往同一个目的地的多条路径。它如何做出选择？背后的关键机制就是路由协议优先级，也称为管理距离。

当我们谈论网络路由时，一个核心问题是：**当路由器从OSPF、RIP、BGP等多种协议中同时学到了通往同一个网络的路由时，它会相信谁？**

答案是：路由器不相信任何协议，它只相信一个叫做**管理距离（Administrative Distance, AD）** 的数字。这个数值是决定最佳路径的第一道，也是最重要的一道关卡。

## 一、什么是管理距离（AD）？

**管理距离（AD）** 是一个0到255之间的整数值，用于衡量路由信息源的**可信度**。它可以理解为路由协议的“优先级”。

**记住一个黄金法则：AD值越小，优先级越高，路由越可信。**

当多条通往同一网络的路由出现在路由器中时，路由器会优先选择AD值最小的那条放入其路由表，而完全忽略AD值更大的路由，无论它们的度量值（Metric）看起来有多好。

### AD与Metric（度量值）的区别

这是一个至关重要的概念区分：

*   **管理距离（AD）**：用于**不同路由协议之间**的比较。回答“哪个协议提供的信息更可信？”。
*   **度量值（Metric）**：用于**同一路由协议内部**的比较。回答“在这个协议提供的多条路径里，哪条更好？”。
    *   *例如：RIP使用跳数（Hops），OSPF使用成本（Cost，通常基于带宽），EIGRP使用复合度量（带宽、延迟等）。*

**决策顺序：先比AD，再比Metric。** 只有当AD值相同时，路由器才会去比较度量值。

## 二、主流路由协议默认优先级（AD值）参考

| 路由来源 | Cisco (思科) | Huawei (华为) | H3C (新华三) | Juniper (瞻博) | 解释 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **直连接口** | **0** | **0** | **0** | **0** | **绝对最高优先级**，所有厂商共识。 |
| **静态路由** | **1** | **60** | **60** | **5** | **重大差异**：思科极度信任静态路由(1)，华为/H3C次之(60)，Juniper折中(5)。 |
| **EBGP** | **20** | **255** | **255** | **170** | **最大差异之一**：思科非常信任eBGP(20)；华为/H3C视其最低(255)；Juniper为170。 |
| **EIGRP (汇总)** | 5 | 5 | 5 | N/A | EIGRP为思科私有协议，其他厂商不支持。 |
| **EIGRP (内部)** | 90 | 100 | 100 | N/A | 同上。 |
| **OSPF** | **110** | **150** | **150** | **10** | **重大差异**：Juniper极其信任OSPF/IS-IS(10)；思科为110；华为/H3C为150。 |
| **IS-IS** | **115** | **15** | **15** | **10** | **重大差异**：华为/H3C极其信任IS-IS(15)；Juniper为10；思科为115。 |
| **RIP** | **120** | **100** | **100** | **100** | 思科中RIP(120)可信度低于OSPF(110)；华为/H3C/Juniper中相反，RIP(100)高于OSPF(150)。 |
| **EIGRP (外部)** | 170 | 170 | 170 | N/A | EIGRP外部路由。 |
| **IBGP** | **200** | **255** | **255** | **170** | **差异**：思科为200；华为/H3C为255（最低）；Juniper与eBGP相同，均为170。 |
| **未知/不可信** | 255 | 255 | 255 | 255 | 所有厂商均视255为不可信，不纳入路由表。 |

## 三、实战场景：路由器如何决策？

让我们通过一个例子来生动理解这个过程。

假设一台**思科路由器**通过三种方式学到了通往网络 `192.168.100.0/24` 的路由：

1.  **通过OSPF**： 下一跳为 `10.1.1.1`，度量值 Cost = 100。
2.  **通过RIP**： 下一跳为 `192.168.2.2`，度量值 Hop = 2。
3.  **静态路由**： 由管理员配置，下一跳为 `172.16.1.1`。

**路由器的决策过程如下：**

1.  **比较AD值**：
    *   静态路由 AD = **1**
    *   OSPF路由 AD = **110**
    *   RIP路由 AD = **120**
2.  **做出选择**：
    *   静态路由的AD值**最小**，因此它被判定为**最可信**的路径。
    *   路由器会毫不犹豫地将这条静态路由加入其**路由表**，并丢弃OSPF和RIP提供的路由信息。
3.  **注意**：
    *   在这个过程中，**度量值（Cost=100 vs Hop=2）完全没有被比较**。因为第一道关卡（AD）已经决出了胜负。

**如果静态路由被移除**，那么OSPF（AD=110）和RIP（AD=120）之间，OSPF会因AD值更小而胜出。

## 四、注意事项与总结

1.  **厂商差异**：上表清晰表明，不同厂商的默认AD值可能大相径庭（如eBGP和IS-IS）。在进行多厂商设备混合组网时，必须仔细检查并可能手动调整AD值，以避免次优路径或路由环路问题。
2.  **可手动调整**：绝大多数网络操作系统都允许管理员手动修改特定路由协议的AD值。例如，你可以将OSPF的AD值从110改为95，使其比内部EIGRP（90）优先级低，但比RIP（120）高。这是一个非常强大的网络控制工具。
3.  **255的含义**：AD值255是一个特殊标记，路由器会直接忽略它，视其为无效路由。

**总结一下**：

理解和管理**路由协议优先级（管理距离）** 是网络工程师必备的核心技能。它是在复杂网络环境中控制流量路径、实现冗余备份和进行路由重分布的基础。记住：**路由器总是优先选择最可信（AD值最小）的路径，信任优先于成本。**